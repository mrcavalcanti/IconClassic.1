<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0057)http://community.borland.com/article/0,1410,16778,00.html -->
<!-- Vignette StoryServer 4 Wed May 14 15:14:06 2003 --><!-- Vignette StoryServer 4 Sat May 24 16:04:25 2003 --><HTML><HEAD><TITLE>Extracting Icons</TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<META content="" name=KEYWORDS>
<META content="" name=DESCRIPTION><LINK title=Default 
href="Extracting Icons_arquivos/0,1748,,00.css" type=text/css rel=stylesheet><!--Site Level a-->
<META content="MSHTML 6.00.2600.0" name=GENERATOR></HEAD>
<BODY bgColor=#ffffff leftMargin=0 topMargin=0><A name=top></A><!-- Vignette StoryServer 4 Tue Feb 01 16:16:14 2000 --><A 
name=top></A><!-- Vignette StoryServer 4 Sat May 24 16:06:23 2003 --><!-- Site level is a -->
<TABLE cellSpacing=0 cellPadding=0 width=670 align=center bgColor=#ffffff 
border=0>
  <TBODY>
  <TR>
    <TD vAlign=top align=left rowSpan=2><A 
      href="http://community.borland.com/index.html"><IMG alt="" 
      src="Extracting Icons_arquivos/bdnetwork2.gif" border=0></A><BR><IMG 
      height=20 alt="" src="Extracting Icons_arquivos/transparent.gif" width=2 
      border=0></TD>
    <TD vAlign=top align=right><A 
      href="https://bdn.borland.com/cgi-bin/login/"><SPAN class=bigBlack>Welcome 
      Marcelo Cavalcanti</SPAN></A></TD></TR>
  <TR>
    <TD vAlign=bottom align=right><A 
      href="http://www.borland.com/">http://www.borland.com/</A></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=670 align=center bgColor=#ffffff 
border=0><!-- 1 {comm_community {AppServer /appserver 6}} {comm_community {C++ /cpp 2}} {comm_community {CORBA /corba 5}} {comm_community {CaliberRM /caliberrm 11}} {comm_community {{Delphi &amp; Kylix} /delphi 1}} {comm_community {InterBase /interbase 7}} {comm_community {JDataStore /jdatastore 9}} {comm_community {Java /java 3}} {comm_community {{Star Team} /starteam 10}} {comm_community {Together /together 12}} -->
  <TBODY>
  <TR>
    <TD class=divider colSpan=21><IMG height=1 
      src="Extracting Icons_arquivos/transparent.gif" width=670 border=0></TD></TR>
  <TR>
    <TD bgColor=#cccccc><IMG height=20 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD align=middle>&nbsp;<A class=topLinkB 
      href="http://community.borland.com/appserver/0,1419,6,00.html">AppServer</A>&nbsp;</TD>
    <TD bgColor=#cccccc><IMG height=20 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD align=middle>&nbsp;<A class=topLinkB 
      href="http://community.borland.com/cpp/0,1419,2,00.html">C++</A>&nbsp;</TD>
    <TD bgColor=#cccccc><IMG height=20 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD align=middle>&nbsp;<A class=topLinkB 
      href="http://community.borland.com/corba/0,1419,5,00.html">CORBA</A>&nbsp;</TD>
    <TD bgColor=#cccccc><IMG height=20 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD align=middle>&nbsp;<A class=topLinkB 
      href="http://community.borland.com/caliberrm/0,1419,11,00.html">CaliberRM</A>&nbsp;</TD>
    <TD bgColor=#cccccc><IMG height=20 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD align=middle>&nbsp;<A class=topLinkB 
      href="http://community.borland.com/delphi/0,1419,1,00.html">Delphi &amp; 
      Kylix</A>&nbsp;</TD>
    <TD bgColor=#cccccc><IMG height=20 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD align=middle>&nbsp;<A class=topLinkB 
      href="http://community.borland.com/interbase/0,1419,7,00.html">InterBase</A>&nbsp;</TD>
    <TD bgColor=#cccccc><IMG height=20 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD align=middle>&nbsp;<A class=topLinkB 
      href="http://community.borland.com/jdatastore/0,1419,9,00.html">JDataStore</A>&nbsp;</TD>
    <TD bgColor=#cccccc><IMG height=20 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD align=middle>&nbsp;<A class=topLinkB 
      href="http://community.borland.com/java/0,1419,3,00.html">Java</A>&nbsp;</TD>
    <TD bgColor=#cccccc><IMG height=20 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD align=middle>&nbsp;<A class=topLinkB 
      href="http://community.borland.com/starteam/0,1419,10,00.html">Star 
      Team</A>&nbsp;</TD>
    <TD bgColor=#cccccc><IMG height=20 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD align=middle>&nbsp;<A class=topLinkB 
      href="http://community.borland.com/together/0,1419,12,00.html">Together</A>&nbsp;</TD>
    <TD class=divider><IMG height=20 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD>&nbsp; </TD></TR></TBODY></TABLE><!-- Vignette StoryServer 4 Sat May 24 16:06:23 2003 --><TR><!-- Vignette StoryServer 4 Sat May 24 16:06:23 2003 -->
<META content="Borland Developer Support Staff" name=author>
<META content=16778 name=id>
<META content="Jul 16 1998 04:31:28:000PM" name=date>
<META content="Feb 11 1998 12:00:00:000AM" name=creationdate>
<META content=FAQ name=type>
<META content=Public name=visibility>
<META content="" name=product>
<META content="" name=platform>
<P><IMG height=51 alt="Borland Developer Support" 
src="Extracting Icons_arquivos/dev_support_logo.gif" width=96 align=left 
border=0>&nbsp; &nbsp; 
<P>
<P><BR><SPAN class=title3>Extracting Icons</SPAN> <SPAN 
class=contentSectionHeading>- by Borland Developer Support Staff</SPAN><BR><PRE> Question and Answer Database

FAQ1778D.txt   Extracting Icons
Category   :Windows API
Platform    :All
Product    :All 32 bit  

Question:
How can I use the undocumented ShellAPI function ExtractIconEx()
to extract the small and large icons from a given file?


Answer:
You can use the undocumented ShellAPI function ExtractIconEx() to
extract both large and small icons from an executable file,
dynamic-link library (DLL), or icon file.

The function is prototyped as:

function ExtractIconEx(lpszFile: PAnsiChar;
                       nIconIndex: Integer;
                       phiconLarge : PhIconArray;
                       phiconSmall: PhIconArray;
                       nIcons: UINT): UINT; stdcall;


Parameters

lpszFile:
 Pointer to a null-terminated string specifying the name of the
executable, DLL, or icon file to extract the icon from.

nIconIndex:
 Specifies the index of the icon to retrieve. If this value is 0, the
function returns the handle of the first icon in the specified file.
If the value is -1 and phiconLarge and phiconSmall are both nil, the
function returns the total number of icons in the executable, DLL, or
icon file to extract the icon from. If the file is an executable or
DLL file, the return value is the number of RT_GROUP_ICON resources.
If the file is an .ICO file, the return value is 1.

phiconLarge:
 Pointer to an array of icon handles for the large icons returned.
This parameter can be nil if only one icon is to be extracted.

phiconSmall
 Pointer to an array of icon handles for the small icons returned.
This parameter can be nil if only one icon is to be extracted.

nIcons
 Specifies the number of icons to extract.

Return Value

The return value is the handle to an icon if only one icon is to be
extracted. If there were no icons found in the file, the return value
is 0.

The following example demonstrates using the ExtractIconEx() function.
Note that the functions are prototyped differently than as prototyped
in the ShellAPI unit, to allow the full usage of the function.

type ThIconArray = array[0..0] of hIcon;
type PhIconArray = ^ThIconArray;

function ExtractIconExA(lpszFile: PAnsiChar;
                        nIconIndex: Integer;
                        phiconLarge : PhIconArray;
                        phiconSmall: PhIconArray;
                        nIcons: UINT): UINT; stdcall;
  external 'shell32.dll' name 'ExtractIconExA';


function ExtractIconExW(lpszFile: PWideChar;
                        nIconIndex: Integer;
                        phiconLarge: PhIconArray;
                        phiconSmall: PhIconArray;
                        nIcons: UINT): UINT; stdcall;
  external 'shell32.dll' name 'ExtractIconExW';

function ExtractIconEx(lpszFile: PAnsiChar;
                       nIconIndex: Integer;
                       phiconLarge : PhIconArray;
                       phiconSmall: PhIconArray;
                       nIcons: UINT): UINT; stdcall;
  external 'shell32.dll' name 'ExtractIconExA';


procedure TForm1.Button1Click(Sender: TObject);
var
    NumIcons : integer;
    pTheLargeIcons : phIconArray;
    pTheSmallIcons : phIconArray;
    LargeIconWidth : integer;
    SmallIconWidth : integer;
    SmallIconHeight : integer;
    i : integer;
    TheIcon : TIcon;
    TheBitmap : TBitmap;
begin
  NumIcons :=
  ExtractIconEx('C:\Program Files\Borland\Delphi 3\BIN\delphi32.exe',
                -1,
                nil,
                nil,
                0);
  if NumIcons &gt; 0 then begin
    LargeIconWidth := GetSystemMetrics(SM_CXICON);
    SmallIconWidth := GetSystemMetrics(SM_CXSMICON);
    SmallIconHeight := GetSystemMetrics(SM_CYSMICON);
    GetMem(pTheLargeIcons, NumIcons * sizeof(hIcon));
    GetMem(pTheSmallIcons, NumIcons * sizeof(hIcon));
    FillChar(pTheLargeIcons^, NumIcons * sizeof(hIcon), #0);
    FillChar(pTheSmallIcons^, NumIcons * sizeof(hIcon), #0);
   ExtractIconEx('C:\Program Files\Borland\Delphi 3\BIN\delphi32.exe',
                  0,
                  pTheLargeIcons,
                  pTheSmallIcons,
                  numIcons);
   {$IFOPT R+}
     {$DEFINE CKRANGE}
     {$R-}
   {$ENDIF}
    for i := 0 to (NumIcons - 1) do begin
      DrawIcon(Form1.Canvas.Handle,
               i * LargeIconWidth,
               0,
               pTheLargeIcons^[i]);
      TheIcon := TIcon. Create;
      TheBitmap := TBitmap.Create;
      TheIcon.Handle := pTheSmallIcons^[i];
      TheBitmap.Width := TheIcon.Width;
      TheBitmap.Height := TheIcon.Height;
      TheBitmap.Canvas.Draw(0, 0, TheIcon);
      TheIcon.Free;
      Form1.Canvas.StretchDraw(Rect(i * SmallIconWidth,
                                    100,
                                    (i + 1) * SmallIconWidth,
                                    100 + SmallIconHeight),
                               TheBitmap);
      TheBitmap.Free;
    end;
   {$IFDEF CKRANGE}
     {$UNDEF CKRANGE}
     {$R+}
   {$ENDIF}
    FreeMem(pTheLargeIcons, NumIcons * sizeof(hIcon));
    FreeMem(pTheSmallIcons, NumIcons * sizeof(hIcon));
  end;
end;

end.



7/16/98 4:31:28 PM
 </PRE>
<P align=left>
<P>
<HR align=left width=400>

<P><SPAN class=body3><A 
href="http://threads.borland.com/threads/threads.exe/add?&amp;sysid=1&amp;contentid=16778&amp;title=Extracting+Icons">Add</A> 
or <A 
href="http://threads.borland.com/threads/threads.exe/thread?&amp;sysid=1&amp;contentid=16778&amp;title=Extracting+Icons">View</A> 
comments on this article
<P></SPAN>
<P><SPAN class=body3><I>Article ID: 16778&nbsp;&nbsp; Publish Date: July 16, 
1998&nbsp;&nbsp;Last Modified: September 01, 1999</I></SPAN> 
</TD><!--TKL Nov--></TR></TABLE><!-- Vignette StoryServer 4 Wed May 21 09:54:41 2003 -->
<TABLE cellSpacing=0 cellPadding=0 width=670 align=center bgColor=#ffffff 
border=0>
  <TBODY>
  <TR>
    <TD colSpan=3>
      <FORM name=seek1 action=http://search.borland.com/query.html 
      method=get><INPUT type=hidden value=url:http://www.borland.com name=qp> 
      <INPUT type=hidden CHECKED value=url:http://bdn.borland.com/ name=qp> 
      <INPUT type=hidden value=nowebdsp name=col> <INPUT type=hidden name=qs> 
      <INPUT type=hidden name=qc> <INPUT type=hidden value=100% name=pw> <INPUT 
      type=hidden value=0 name=ws> <INPUT type=hidden name=la> <INPUT 
      type=hidden value=0 name=qm> <INPUT type=hidden value=1 name=st> <INPUT 
      type=hidden value=10 name=nh> <INPUT type=hidden value=1 name=lk> <INPUT 
      type=hidden value=0 name=rf> <INPUT type=hidden name=oq> <INPUT 
      type=hidden value=0 name=rq> 
  <TR>
    <TD class=divider colSpan=11><IMG height=1 
      src="Extracting Icons_arquivos/transparent.gif" border=0></TD></TR>
  <TR vAlign=center align=middle>
    <TD class=divider width=1><IMG height=17 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD class=topLinkB><A class=topLinkB 
      href="http://community.borland.com/info/">Help</A>&nbsp;</TD>
    <TD class=divider width=1><IMG height=17 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD class=topLinkB><A class=topLinkB 
      href="http://community.borland.com/feedback/">Feedback</A>&nbsp;</TD>
    <TD class=divider width=1><IMG height=17 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD class=topLinkB><A class=topLinkB 
      href="http://community.borland.com/homepages/">Home Pages</A>&nbsp;</TD>
    <TD class=divider width=1><IMG height=17 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD class=topLinkB><A class=topLinkB 
      href="http://info.borland.com/newsgroups">Newsgroups</A>&nbsp;</TD>
    <TD class=divider width=1><IMG height=17 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD>
    <TD class=topLinkB align=right><A class=topLinkB 
      href="http://search.borland.com/">Search</A>&nbsp; <INPUT class=srchBox 
      maxLength=2033 size=10 name=qt></TD>
    <TD class=topLinkB><IMG height=1 
      src="Extracting Icons_arquivos/transparent.gif" width=5 border=0></TD>
    <TD class=divider width=1><IMG height=17 
      src="Extracting Icons_arquivos/transparent.gif" width=1 border=0></TD></TR>
  <TR>
    <TD class=divider colSpan=11></FORM><IMG height=1 alt="" 
      src="Extracting Icons_arquivos/dots.gif" width=670 border=0></TD></TR>
  <TR>
    <TD class=footer align=middle colSpan=11><BR>Made in Borland® Copyright© 
      1994-2003 Borland Software Corporation. All rights reserved. <A 
      href="http://www.borland.com/company/legal.html">Legal Notices</A>, <A 
      href="http://www.borland.com/company/privacy.html">Privacy 
  Policy</A></TD></TR></TBODY></TABLE><!-- Vignette StoryServer 4 Wed May 15 11:28:33 2002 --></P></BODY></HTML>
